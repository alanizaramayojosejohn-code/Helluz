<div class="min-h-screen bg-white p-6">
   <div class="max-w-7xl mx-auto">
      <!-- Header -->
      <div class="flex justify-between items-center mb-8">
         <div>
            <h1 class="text-4xl font-bold text-red-600 mb-2">Gestión de Horarios</h1>
            <p class="text-gray-600">Administra los horarios de las clases</p>
         </div>
         <button
            (click)="onCreateSchedule()"
            class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold transition flex items-center gap-2"
         >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            Nuevo Horario
         </button>
      </div>

      <!-- Filtros -->
      <div class="bg-white shadow-sm shadow-black border border-gray-800 rounded-lg p-4 mb-6">
         <mat-form-field appearance="outline" class="w-full md:w-64">
            <mat-label>Filtrar por Sucursal</mat-label>
            <mat-select [value]="'all'" (selectionChange)="onBranchFilterChange($event.value)">
               <mat-option value="all">Todas las sucursales</mat-option>
               @for (branch of branches$ | async; track branch.id) {
                  <mat-option [value]="branch.id">{{ branch.name }}</mat-option>
               }
            </mat-select>
         </mat-form-field>
      </div>

      <!-- Error Message -->
      @if (errorMessage()) {
         <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
            <div class="flex items-center gap-3">
               <svg class="w-5 h-5 text-red-600" fill="currentColor" viewBox="0 0 20 20">
                  <path
                     fill-rule="evenodd"
                     d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                     clip-rule="evenodd"
                  />
               </svg>
               <p class="text-sm text-red-800">{{ errorMessage() }}</p>
            </div>
         </div>
      }

      <!-- Loading -->
      @if (isLoading()) {
         <div class="flex justify-center items-center py-12">
            <mat-spinner diameter="50"></mat-spinner>
         </div>
      }

      <!-- Lista de Horarios -->
      @if (!isLoading()) {
         @if ((schedules$ | async)?.length === 0) {
            <div class="bg-white shadow-sm shadow-black border border-gray-800 rounded-lg p-12 text-center">
               <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path
                     stroke-linecap="round"
                     stroke-linejoin="round"
                     stroke-width="2"
                     d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                  />
               </svg>
               <p class="text-xl text-gray-600 mb-2">No hay horarios registrados</p>
               <p class="text-gray-500 mb-6">Comienza creando tu primer horario</p>
               <button
                  (click)="onCreateSchedule()"
                  class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold transition"
               >
                  Crear Horario
               </button>
            </div>
         } @else {
            <div class="bg-white shadow-sm shadow-black border border-gray-800 rounded-lg overflow-x-auto">
               <table mat-table [dataSource]="(schedules$ | async)!" class="w-full">
                  <!-- Día -->
                  <ng-container matColumnDef="day">
                     <th mat-header-cell *matHeaderCellDef class="font-semibold">Día</th>
                     <td mat-cell *matCellDef="let schedule">
                        <span class="font-medium text-gray-700">
                           {{ getDayLabel(schedule.day) }}
                        </span>
                     </td>
                  </ng-container>

                  <!-- Horario -->
                  <ng-container matColumnDef="time">
                     <th mat-header-cell *matHeaderCellDef class="font-semibold">Horario</th>
                     <td mat-cell *matCellDef="let schedule">
                        <div class="flex items-center gap-2">
                           <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path
                                 stroke-linecap="round"
                                 stroke-linejoin="round"
                                 stroke-width="2"
                                 d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                              />
                           </svg>
                           <span>{{ getTimeRange(schedule) }}</span>
                        </div>
                     </td>
                  </ng-container>

                  <!-- Disciplina -->
                  <ng-container matColumnDef="discipline">
                     <th mat-header-cell *matHeaderCellDef class="font-semibold">Disciplina</th>
                     <td mat-cell *matCellDef="let schedule">
                        <mat-chip [class]="getDisciplineColor(schedule.discipline) + ' text-white'">
                           {{ getDisciplineLabel(schedule.discipline) }}
                        </mat-chip>
                     </td>
                  </ng-container>

                  <!-- Instructor -->
                  <ng-container matColumnDef="instructor">
                     <th mat-header-cell *matHeaderCellDef class="font-semibold">Instructor</th>
                     <td mat-cell *matCellDef="let schedule">
                        @if (schedule.instructorName) {
                           <span class="text-gray-700">{{ schedule.instructorName }}</span>
                        } @else {
                           <span class="text-gray-400 text-sm">Sin asignar</span>
                        }
                     </td>
                  </ng-container>

                  <!-- Sucursal -->
                  <ng-container matColumnDef="branch">
                     <th mat-header-cell *matHeaderCellDef class="font-semibold">Sucursal</th>
                     <td mat-cell *matCellDef="let schedule">
                        {{ schedule.branchName }}
                     </td>
                  </ng-container>

                  <!-- Acciones -->
                  <ng-container matColumnDef="actions">
                     <th mat-header-cell *matHeaderCellDef class="font-semibold text-right">Acciones</th>
                     <td mat-cell *matCellDef="let schedule" class="text-right">
                        <button
                           mat-icon-button
                           (click)="onViewDetail(schedule)"
                           matTooltip="Ver detalle"
                           class="text-blue-600 hover:text-blue-800"
                        >
                           <mat-icon>visibility</mat-icon>
                        </button>
                        <button
                           mat-icon-button
                           (click)="onEditSchedule(schedule)"
                           matTooltip="Editar"
                           class="text-gray-600 hover:text-gray-800"
                        >
                           <mat-icon>edit</mat-icon>
                        </button>
                     </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                  <tr
                     mat-row
                     *matRowDef="let row; columns: displayedColumns"
                     class="hover:bg-gray-50 transition-colors"
                  ></tr>
               </table>
            </div>
         }
      }
   </div>
</div>
